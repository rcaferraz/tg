\chapter{Fundamentos do funcionamento e infraestrutura da Internet} \label{cap:Fundamentos}
\begin{minipage}[t][10\baselineskip][t]{\linewidth}
\begin{epigraph}[Profiles Of The Future: An Inquiry into the Limits of the Possible, 1958]{Arthur C. Clarke}
Any sufficiently advanced technology is indistinguishable from magic.
\end{epigraph}
\end{minipage}

%Devido à sua organização descentralizada, a Internet é uma plataforma de comunicação mais robusta a desastres do que os seus antecessores telefonia, rádio e TV. Para quaisquer desses serviços ficarem indisponíveis, basta que se destrua sua respectiva torre de transmissão, no caso de rádio e TV, ou central de comutação no caso dos telefones. Essa maior robustez da Internet, entre outras novidades, acabou gerando uma propaganda em seu favor, no início da sua popularização, que chegou ao ponto de classificá-la erroneamente como incensurável em \cite{time-dewitt}. Para o leitor ter uma visão mais crítica sobre o que se veicula nos meios de comunicação e entender melhor o que será apresentado neste trabalho, este capítulo irá resumir os conceitos básicos que tangem o funcionamento da Internet e sua infraestrutura.

Neste capítulo, será explicado de forma simplificada o funcionamento da rede que nos conecta a bilhões de outras pessoas todos os dias. Primeiro, será apresentada uma analogia com um serviço postal, para explicar como os dados são transmitidos pela rede, e as pequenas diferenças para um correio normal, que a tornam um meio de comunicação facilmente susceptível a vigilância e censura. Em seguida, serão apresentadas algumas definições necessárias para o entendimento do trabalho.

\section{Analogia com serviço postal} \label{sec:AnalogiaServicoPostal}

A Internet funciona como o serviço de um correio. Cada encomenda possui um certo conteúdo e deve apresentar uma etiqueta contendo o endereço do remetente e o endereço destino. Antes de chegar ao destino final, os pacotes da Internet precisam passar por diversas agências e centros de distribuição. Neste correio, no entanto, o conteúdo das encomendas não é protegido. Qualquer elemento que participe da entrega pode ver o conteúdo, armazenar cópias, e o mesmo pode ser feito com a etiqueta contendo os endereços. Na verdade, muitos governos exigem que os responsáveis pelo trânsito destas ``encomendas'' copiem e armazenem esses dados por um tempo mínimo, para possíveis investigações policiais futuras.

Qualquer ponto que participe do reencaminhamento de pacotes, portanto, pode ser utilizado como elemento atuador de uma política de censura e vigilância. Para censurar, basta descartar pacotes que possuam conteúdo considerado inapropriado. Ou então, apenas a partir das informações da etiqueta, pode-se descartar mensagens remetidas por endereços específicos, ou endereçadas a tais destinos. Já a vigilância pode ser praticada com a simples gravação dos dados, instalando uma espécie de gravador em um ponto de convergência de mensagens (centros de recebimento e reenvio).

\section{O uso da criptografia na Internet} \label{sec:criptografia}
Infelizmente não são apenas as entidades envolvidas no tráfego dos dados que têm a chance de visualizar todo o conteúdo transmitido na rede. Os ``piratas de computador'', com toda sua expertise em computação e segurança, sem muita dificuldade encontram brechas de segurança e conseguem interceptar esses pacotes sem serem notados. Esses piratas podem ser criminosos, tentando auferir lucro a partir de informações como dados do cartão de crédito, ou podem ser agentes do governo ou espiões contratados para obter informações sigilosas de indivíduos, empresas ou países. Para contornar esse problema, foram desenvolvidas soluções que têm como objetivo tornar a mensagem ilegível para leitores não autorizados. Apenas o destinatário é capaz de tornar a mensagem legível. Essas soluções se baseiam nos conceitos da criptografia, que existem há milênios, desde que o ser humano sentiu a necessidade de ocultar mensagens a indivíduos indesejados.

O processo de criptografia de mensagens trata-se apenas de uma série de operações matemáticas executadas sobre a mensagem com o objetivo de descaracterizá-la e tornar o processo inverso uma tarefa virtualmente impossível\footnote{Um exemplo de operação que é fácil de ser calculada seria o produto entre dois números primos muito grandes. Realizar este cálculo é simples e qualquer computador é capaz. No entanto, conhecendo apenas o resultado, encontrar quais foram os números utilizados na multiplicação é uma tarefa difícil até mesmo para supercomputadores. É possível, mas pode levar anos, talvez séculos, sendo na prática, impossível de reverter o processo para fins práticos.}. No entanto, é possível inverter o processo se for utilizada uma chave. Com a chave correta, a mensagem original pode ser obtida facilmente.

Existem dois tipos de chaves para criptografia. Chaves assimétricas e chaves simétricas. No caso das chaves assimétricas, a chave utilizada para esconder a mensagem (criptografar) é diferente daquela utilizada para decodificá-la (descriptografar). No caso das chaves simétricas, a chave para criptografia e descriptografia são idênticas.

Uma aplicação das chaves assimétricas é o conceito de chave pública e chave privada. Um servidor que deseja proteger as mensagens que recebe deve gerar as duas chaves. A chave pública é a chave utilizada para criptografar as mensagens, já a chave privada é aquela utilizada para a descriptografia. Como o próprio nome diz, a chave pública não precisa ser escondida, ela deve estar disponível para quem quiser se comunicar com aquele servidor. O usuário criptografa a mensagem usando a chave pública e envia para o servidor. Já a chave privada deve ser conhecida apenas pelo servidor que a gerou e deve ser protegida a qualquer custo. Somente ela é capaz de descriptografar as mensagens criptografadas com a chave pública. Muitas vezes se utilizam chaves assimétricas apenas para iniciar uma comunicação e combinar uma chave simétrica que apenas os dois conheçam.

Um risco da utilização de chaves públicas e privadas é o conhecido ataque \emph{man in the middle} (homem no meio, em inglês). Como o nome diz, trata-se de uma forma de ouvir a conversa, posicionando-se entre as duas entidades que desejam se comunicar. Para o servidor o atacante finge ser o usuário, e para o usuário ele finge ser o servidor, funcionando como uma ponte entre eles sem que percebam. Primeiro, o elemento mal intencionado induz o usuário utilizar uma chave pública diferente daquela realmente oferecida pelo servidor. Esta chave pública é na verdade uma gerada pelo agente do ataque, cuja chave privada correspondente ele conhece. O que ele faz então é se passar pelo servidor, recebendo os pacotes que o usuário envia, descriptografando-os, lendo-os e criptografando-os novamente, utilizando a chave pública verdadeira do servidor, e os envia, fingindo ser o usuário.

\section{Pacotes IP}
Outra diferença para um correio normal é que os carteiros, ou veículos que levam as encomendas, só são capazes de levar pacotes bem pequenos. Então, quase sempre o conteúdo a ser enviado é dividido em pacotes menores e enviados separadamente. Ao chegar no destinatário, o conteúdo das frações da encomenda são reunidos, formando-se o dado enviado originalmente.

Para tornar possível a comunicação e o entendimento entre diversos tipos de dispositivos em uma mesma rede, foi necessário estabelecer certos padrões. Estes padrões compõem o chamado protocolo de comunicação IP (Internet Protocol) e determinam o formato das mensagens transmitidas. Essas mensagens são digitais, ou seja, são formadas apenas por números. Não há etiquetas físicas, nem caixas, como num correio real. Na Internet, o endereço remetente é um número, o endereço destino é outro, e o conteúdo a ser enviado são mais números. Estes números são enviados em sequência e não há espaços, nem divisórias entre eles. Portanto, é preciso que o emissor e receptor combinem que informação vem primeiro e qual o comprimento de cada uma. O protocolo IP define isso. A sigla IP também é utilizada para se referir ao endereço que identifica cada participante da rede IP (outro nome para a Internet). Como dito anteriormente, os endereços são formados apenas por números. O comprimento do endereço IP é 32 bits, ou 4 bytes e pode ser representado como 4 bytes separados por pontos. Como um byte pode guardar valores de 0 a 255, então os endereços IP variam de 0.0.0.0 a 255.255.255.255.

Tudo que é acessível via Internet precisa ter um endereço IP. O Facebook possui um, o Youtube possui outro, e você, para acessá-los, também precisa de um.

Os pacotes trocados via Internet podem transportar vários tipos de dados: o texto de um e-mail, um vídeo do \emph{Youtube}, a senha da sua conta do \emph{Facebook} depois de você clicar em "Entrar", ou seja, tudo que trafega na rede são transformados em zeros e uns e enviados através destes pacotes. Ao chegar no destino, estes zeros e uns são reconvertidos para o tipo de conteúdo original, seja o texto de e-mail ou vídeo do Youtube.

Logo, quando enviamos um pacote a partir do nosso computador, este pacote acompanha nosso endereço IP, o endereço IP do destinatário e o dado que será recebido por ele. Todas estas informações são lidas por diversos dispositivos que são responsáveis por encaminhar nosso pacote até o destino. Estes dispositivos muitas vezes armazenam todos estes dados por longos períodos.

\subsection{Como funcionam a Web e os servidores de nomes} \label{subsec:HowWebAndDNSWorks}
Quando acessamos um website como \url{www.loremipsum.com/posts/3}, primeiro é enviado um pacote ao computador (também chamado de servidor) que contém a página procurada. O conteúdo deste pacote é um pedido, requisitando um certo recurso. Neste caso . O Website então responde com outros pacotes, contendo a página, que ao chegar no computador do internauta, é exibida no navegador. Quando o usuário clica em algum link do site, uma nova requisição é enviada, que por sua vez é respondida novamente com outra página. A navegação na Web funciona basicamente desta forma: requisições dos usuários e respostas dos servidores Web, em forma de páginas.

No entanto, para o correio entregar os pedidos de página do usuário, ele precisa do endereço IP destino. Este endereço é formado apenas por alguns números. Não há nomes, nem ruas, nem cidades neste endereço.

Como ficaria difícil para os internautas decorar os números dos endereços IP de todos os seus Websites favoritos, foi criada uma espécie de agenda de endereços, compartilhada em todo o mundo, que contém nomes associados a endereços IP. Assim, em vez de decorarmos que o endereço do Google é 74.125.234.240, basta que decoremos seu nome: \emph{www.google.com}.

Essa agenda é armazenada em servidores conhecidos como Servidor DNS (\emph{Domain Name System}) ou Servidor de Nomes. Como é de se esperar, os Servidores DNS também possuem um endereço IP, e se o usuário desejar, pode configurar qual servidor DNS será utilizado. Todavia, não há necessidade de ficar trocando o Servidor DNS, visto que todos devem responder da mesma forma. A agenda de nomes e endereços deve ser idêntica para todos conectados na Web.

Quando digitamos apenas um nome como \emph{www.youtube.com} na página de endereços, por padrão nos é apresentada a sua página inicial. No entanto, podemos querer acessar uma página (ou recurso) específica. Se acessarmos \emph{www.youtube.com/watch?v=b-gG5qmXFUA} estamos pedindo ao Youtube o recurso "/watch?v=b-gG5qmXFUA". Então nosso navegador fica encarregado de consultar um servidor DNS, transformar o nome \emph{www.youtube.com} em um endereço IP, e mandar um pacote para este IP pedindo o recurso "/watch?v=b-gG5qmXFUA". Por ser possível acessar recursos de servidores, estes endereços WWW muitas vezes são chamados de URL (\emph{Universal Resource Location}).

\section{Algumas definições}

%Fonte: http://www.ptt.br/documentacao

\paragraph*{Provedor de Acesso Serviços e Informações da Rede Internet (Internet Service Provider - ISP).}
	Garante que um indivíduo tenha acesso a toda a Internet e, para o caso de provedores de conteúdo, garantir que outros usuários possam visualizar seus serviços disponibilizados na rede. Exemplos: GVT, Oi.
	
%\paragraph*{Autonomous Systems (ASs).}
%	Todo ISP possui uma rede e caso esta rede possa adotar suas próprias políticas de administração de rede e seja registrada na LACNIC, ele terá responsabilidade pela sua rede e passará a ser um AS (Autonomous System), com um ASN (Autonomous System Number) que o identificará.

\paragraph*{Peering.}
	Para um cliente de um ISP poder acessar o conteúdo de um cliente de outro ISP, é necessário que exista uma conexão entre estes ISPs. Uma conexão direta entre os ISPs é chamada de peering.

\paragraph*{Trânsito.}
	Uma forma de um ISP fornecer acesso a vários outros ISPs para seus clientes, seria fazer Peering com todos os outros ISPs. No entanto há mais de 10000 ISPs independentes no mundo, então torna-se inviável que um ISP se conecte diretamente a todos os outros.

	Caso a rede do ISP1 queira se conectar com a rede do ISP2, não é necessário que crie um peering (conexão direta) entre elas. A rede do ISP1 pode negociar com uma terceira rede ISP3, que já possui Peering com a ISP2, e pedir para usar a rede ISP3 para ganhar acesso a ISP2. O uso de uma ou várias redes ISPs para alcançar uma rede destino é chamada de trânsito.

\paragraph*{Tier One peer.}
	Alguns ISPs no mundo tem acesso a toda a Internet, mas não pagam por "trânsito" a nenhum outro ISP. Eles são chamados de "Tier One" e fazem "peering" entre si, para vender trânsito para os outros ISPs (ISPs menores).

	Portanto, para ter acesso a toda a Internet, ou o seu ISP ou um de seus "up-stream provider" terá conexão com pelo menos um "tier one".

\paragraph*{Peering privado e Ponto de Troca de Tráfego.}
	Se você não for um Tier One, obrigatoriamente terá que pagar por trânsito a algum outro ISP para ter acesso a toda a Internet. No entanto, se você possuir Peering com algum ISP, você economiza, pois esta conexão não passa por nenhum atravessador e você não precisa pagar por ela, apenas o custo de manutenção do link. Portanto, peering é de interesse de qualquer ISP, pequeno ou grande.

	Peering pode ser feito um a um, via interconexão direta (peering privado) ou através de um ponto de troca de tráfego (PTT), um local com uma infraestrutura compartilhada, onde os ISPs se juntam para interconectar suas redes. No caso, cada ISP pagará pelo uso dessa infraestrutura, mas não estarão pagando por trânsito, uma vez que estão conectados diretamente aos ISPs que participam deste PTT.

	Idealmente, existe no máximo um PTT em uma metrópole.

\paragraph*{Ponto de Troca de Tráfego (PTT) ou Internet Exchange Point (IXP).}
	Infraestrutura necessária para a interconexão direta entre as redes de diferentes ISPs.

